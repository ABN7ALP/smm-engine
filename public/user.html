<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SMM Engine | Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ</title>

  <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

  <!-- Ù…Ù„Ù Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container-page">

    <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ¦Ø© -->
    <div id="step1" class="step">
        <div class="text-center mb-3">
          <h1 class="fw-bold">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§</h1>
          <p class="small-muted">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¯Ø¹Ù…Ù‡Ø§</p>
        </div>
        <div id="categories-grid" class="row g-3 justify-content-center"></div>
    </div>

    <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø°ÙƒÙŠØ© -->
    <div id="step2" class="step" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 id="order-category-title" class="fw-bold mb-0"></h2>
            <button class="btn btn-outline-secondary" id="backBtn"><i class="fas fa-arrow-right me-2"></i>Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
        </div>
        <div class="row g-4">
            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ -->
            <div class="col-lg-7">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <!-- 1. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø© -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">1. Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©:</label>
                            <select id="service-select" class="form-select form-select-lg"></select>
                        </div>
                        <!-- 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">2. Ø¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·:</label>
                            <div class="input-group">
                                <input id="link-input" class="form-control form-control-lg" placeholder="https://www.example.com/...">
                                <button id="analyzeBtn" class="btn btn-primary">
                                    <i class="fas fa-magic me-1"></i> ØªØ­Ù„ÙŠÙ„
                                </button>
                            </div>
                        </div>

                        <!-- Ø­Ø§ÙˆÙŠØ© Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ -->
                        <div id="analysis-container" class="mt-3"></div>

                        <!-- 3. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ© -->
                        <div id="quantity-container" class="mb-3" style="display:none;">
                            <label class="form-label fw-bold">3. Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
                            <input id="quantity-input" type="number" class="form-control form-control-lg" placeholder="1000" min="1">
                            <div id="limits-info" class="form-text mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
            <div class="col-lg-5">
                <div class="card shadow-sm mb-4">
                    <div class="card-body text-center p-4">
                        <h6 class="text-muted mb-2">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h6>
                        <div id="total-price" class="display-5 fw-bolder text-primary mb-3">$0.00</div>
                        <div class="d-grid">
                            <button id="confirmOrderBtn" class="btn btn-primary btn-lg fw-bold"><i class="fas fa-check-circle me-2"></i>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
                        </div>
                    </div>
                </div>
                <div id="orderStatusBox"></div>

                  <!-- Track Order Card -->
                  <div class="card shadow-sm">
                      <div class="card-body p-4">
                          <h5 class="card-title fw-bold mb-3"><i class="fas fa-search text-primary me-2"></i>Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨</h5>
                          <div class="input-group">
                              <input id="orderIdInput" type="text" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">
                              <button id="trackBtn" class="btn btn-outline-primary">Ø¨Ø­Ø«</button>
                          </div>
                          <div id="orderResult" class="mt-3"></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    </div>
  </div>

<script>
   
    
      
  // =================================================================
//  Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù€ user.html (v7 - Ù…Ø­ØµÙ‘Ù† Ø¶Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
// =================================================================

/* ===================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³Ø±ÙŠØ¹Ø© ===================== */
const PHONE_NUMBER = "905367893256";
/* ======================================================== */

// --- 1. ØªØ¹Ø±ÙŠÙ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ø³Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ ---
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const categoriesGrid = document.getElementById('categories-grid');
const orderCategoryTitle = document.getElementById('order-category-title');
const serviceSelect = document.getElementById('service-select');
const linkInput = document.getElementById('link-input');
const quantityContainer = document.getElementById('quantity-container');
const quantityInput = document.getElementById('quantity-input');
const limitsInfo = document.getElementById('limits-info');
const totalPriceDisplay = document.getElementById('total-price');
const confirmOrderBtn = document.getElementById('confirmOrderBtn');
const orderStatusBox = document.getElementById('orderStatusBox');
const orderIdInput = document.getElementById('orderIdInput');
const trackBtn = document.getElementById('trackBtn');
const orderResult = document.getElementById('orderResult');
const backBtn = document.getElementById('backBtn');
const analyzeBtn = document.getElementById('analyzeBtn');
const analysisContainer = document.getElementById('analysis-container');

let allServices = [];
let servicesByCategory = {};

// --- 2. Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ù…Ù†ØµØ§Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ---
const platformKeywords = {
  'ÙŠÙˆØªÙŠÙˆØ¨': ['youtube.com', 'youtu.be'],
  'Ø§Ù†Ø³ØªØ§': ['instagram.com'],
  'ØªÙŠÙƒ ØªÙˆÙƒ': ['tiktok.com'],
  'ÙÙŠØ³ Ø¨ÙˆÙƒ': ['facebook.com', 'fb.watch'],
  'ØªÙˆÙŠØªØ±': ['twitter.com', 'x.com'],
  'ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…': ['t.me'],
  'Ø³Ø¨ÙˆØªÙŠÙÙŠ': ['spotify.com'],
  'ÙƒÙˆØ§ÙŠ': ['kwai.com'],
  'Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯': ['discord.gg', 'discord.com/invite'],
  'Ø³Ù†Ø§Ø¨ Ø´Ø§Øª': ['snapchat.com'],
  'Ø±ÙƒÙ„Ø©': ['kick.com'],
};

// --- 3. Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ÙØ¦Ø§Øª ---
const categoryIcons = {
  'instagram':'https://storage.perfectcdn.com/kgcodj/jobdmcyfy04m4y2j.gif','Ø§Ù†Ø³ØªØºØ±Ø§Ù…':'https://storage.perfectcdn.com/kgcodj/jobdmcyfy04m4y2j.gif','Ø§Ù†Ø³ØªØ§':'https://storage.perfectcdn.com/kgcodj/jobdmcyfy04m4y2j.gif','tiktok':'https://storage.perfectcdn.com/kgcodj/ucyfuh8bjadfcbka.gif','ØªÙŠÙƒ ØªÙˆÙƒ':'https://storage.perfectcdn.com/kgcodj/ucyfuh8bjadfcbka.gif','facebook':'https://storage.perfectcdn.com/kgcodj/3z7kylkenb7i121g.gif','ÙÙŠØ³ Ø¨ÙˆÙƒ':'https://storage.perfectcdn.com/kgcodj/3z7kylkenb7i121g.gif','twitter':'https://storage.perfectcdn.com/kgcodj/xgyjzbkog3f6k18m.gif','ØªÙˆÙŠØªØ±':'https://storage.perfectcdn.com/kgcodj/xgyjzbkog3f6k18m.gif','ÙŠÙˆØªÙŠÙˆØ¨':'https://storage.perfectcdn.com/kgcodj/0y8fkhw1iiheqocr.gif','youtube':'https://storage.perfectcdn.com/kgcodj/0y8fkhw1iiheqocr.gif','telegram':'https://storage.perfectcdn.com/kgcodj/zfcqfa652rzd4bam.gif','ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…':'https://storage.perfectcdn.com/kgcodj/zfcqfa652rzd4bam.gif','Ù…Ù…ÙŠØ²':'https://storage.perfectcdn.com/kgcodj/ozorw4pm8q3muxj9.png', 'Ø³Ø¨ÙˆØªÙŠÙÙŠ': 'https://storage.perfectcdn.com/api/icons/spotify.png', 'ÙƒÙˆØ§ÙŠ': 'https://storage.perfectcdn.com/api/icons/kwai.png', 'Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯': 'https://storage.perfectcdn.com/api/icons/discord.png', 'Ø³Ù†Ø§Ø¨ Ø´Ø§Øª': 'https://storage.perfectcdn.com/api/icons/snapchat.png', 'Ø±ÙƒÙ„Ø©': 'https://storage.perfectcdn.com/api/icons/kick.png'
};

// --- 4. Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù…Ù†Ø¸Ù…Ø© ÙˆÙ…Ø±ØªØ¨Ø©) ---

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø£Ù…Ø§Ù†
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¬Ù…Ø§Ù„ÙŠØ© (12345 -> 12.3 Ø£Ù„Ù)
function formatNumber(num) {
    if (num === null || num === undefined || num === '') return '0';
    num = Number(num);
    if (isNaN(num)) return '0';
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… toFixed(1) Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø¹Ø´Ø±ÙŠ ÙˆØ§Ø­Ø¯ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1).replace(/\.0$/, '') + ' Ù…';
    }
    if (num >= 1000) {
        // âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ± (66.9 Ø£Ù„Ù)
        return (num / 1000).toFixed(1).replace(/\.0$/, '') + ' Ø£Ù„Ù';
    }
    // âœ… Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ¶Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØºÙŠØ±Ø© ÙƒÙ…Ø§ Ù‡ÙŠ (Ù…Ø«Ù„ 800)
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

 
// user.html - Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
function getSmartRecommendation(platform, data) {
    const views = Number(data.views) || 0;
    const likes = Number(data.likes) || 0;
    const comments = Number(data.comments) || 0;
    const followers = Number(data.followers) || 0;

    if (platform === 'YouTube') {
        const likeToViewRatio = (likes / views) * 100;
        if (likeToViewRatio > 3.0) {
            return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØªÙ…ØªØ¹ Ø¨Ù†Ø³Ø¨Ø© ØªÙØ§Ø¹Ù„ Ù…Ù…ØªØ§Ø²Ø©. Ù†Ù‚ØªØ±Ø­ ØªØ¹Ø²ÙŠØ²Ù‡ Ø¨Ø¨Ø§Ù‚Ø© Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù†ØªØ´Ø§Ø±Ù‡ ÙÙŠ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ÙŠÙˆØªÙŠÙˆØ¨.';
        } else if (likeToViewRatio < 1.0) {
            return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ­Ø¸Ù‰ Ø¨Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø¬ÙŠØ¯Ø© ÙˆÙ„ÙƒÙ† Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ù†Ø®ÙØ¶. Ù†Ù†ØµØ­ Ø¨Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙØ§Ø¹Ù„.';
        }
        return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ØªÙˆØ§Ø²Ù† Ø§Ù„ØªÙØ§Ø¹Ù„. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ù„Ø¯Ø¹Ù… Ø´Ø§Ù…Ù„ (Ù…Ø´Ø§Ù‡Ø¯Ø§ØªØŒ Ø¥Ø¹Ø¬Ø§Ø¨Ø§ØªØŒ ØªØ¹Ù„ÙŠÙ‚Ø§Øª) Ø­Ø³Ø¨ Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ.';
    } else if (platform === 'TikTok') {
        const engagementRatio = ((likes + comments) / views) * 100;
        if (engagementRatio < 1.0) {
            return 'ØªÙØ§Ø¹Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª. Ù†Ù‚ØªØ±Ø­ ÙÙˆØ±Ø§Ù‹ Ø±ÙØ¹ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµØ© Ø¸Ù‡ÙˆØ±Ù‡ ÙÙŠ ØµÙØ­Ø© "Ù„Ùƒ" (For You Page).';
        } else if (comments / views > 0.005) {
            return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ«ÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø´! Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ²Ø¯Ù‡Ø§ Ù„Ø¬Ø¹Ù„Ù‡ ØªØ±Ù†Ø¯. ÙƒÙ…Ø§ Ù†Ù‚ØªØ±Ø­ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù‚ÙˆÙŠØ© Ù„Ø¯Ø¹Ù… Ø§Ù„Ø²Ø®Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ.';
        }
        return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØªÙ…ØªØ¹ Ø¨ØªÙØ§Ø¹Ù„ Ø¬ÙŠØ¯ ÙˆÙ…ØªÙˆØ§Ø²Ù†. Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù†ØªØ´Ø§Ø±ØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ø¨Ø§Ù‚Ø© Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø§Ù„Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª.';
    } else if (platform === 'Instagram') {
        let advice = 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¯Ø¹Ù…. Ù†Ù‚ØªØ±Ø­ Ø¨Ø¯Ø¡ Ø¨Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ†!';
        if (followers > 50000) {
            advice = 'Ø­Ø³Ø§Ø¨ ÙƒØ¨ÙŠØ± ÙˆÙ†Ø´Ø·! Ù…Ø«Ø§Ù„ÙŠ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ…Ø±.';
        } else if (followers > 1000) {
            advice = 'Ø­Ø³Ø§Ø¨ Ù†Ø´Ø·! Ù…Ø«Ø§Ù„ÙŠ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†.';
        }
        if (data.isPrivate) {
            advice += ' (ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø­Ø³Ø§Ø¨ Ø®Ø§Øµ - ÙŠØ­ØªØ§Ø¬ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©)';
        }
        return advice;
    }
    return data.message || 'ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­.';
}
  
  

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­ØµÙ‘Ù†Ø©)
analyzeBtn.addEventListener('click', async () => {
  const url = linkInput.value.trim();
  if (!url) {
    analysisContainer.innerHTML = `<div class="alert alert-warning">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹.</div>`;
    return;
  }

  const categoryTitle = orderCategoryTitle.textContent.replace('Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø§Øª', '').trim().toLowerCase();
  const allowedKeywords = platformKeywords[categoryTitle];
  if (allowedKeywords && !allowedKeywords.some(keyword => url.includes(keyword))) {
    analysisContainer.innerHTML = `<div class="alert alert-danger">âŒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§ ÙŠÙ†ØªÙ…ÙŠ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© "${categoryTitle}".</div>`;
    return;
  }

  analysisContainer.innerHTML = `<div class="d-flex align-items-center text-primary p-3"><div class="spinner-border me-3" role="status"></div><strong>Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·...</strong></div>`;
  analyzeBtn.disabled = true;

  try {
    const res = await fetch('/api/analyze', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ url })
    });
    const data = await res.json();
    if (!res.ok || data.error) {
        throw new Error(data.message || `ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (Status: ${res.status})`);
    }

    // user.html - Ø¯Ø§Ø®Ù„ analyzeBtn.addEventListener
// ...
    let analysisHTML = '<div class="alert alert-info">';
    analysisHTML += '<h5 class="alert-heading">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙˆØ±ÙŠ</h5>';

    // ================================================================
    //  âœ… Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ­Ø¯: Ù„Ù„Ù€ thumbnail Ø£Ùˆ Ø§Ù„Ù€ profilePic
    // ================================================================
    if (data.thumbnail || data.profilePic) {
        const imgSrc = data.thumbnail || data.profilePic;
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ†Ø³ÙŠÙ‚ Ø¯Ø§Ø¦Ø±ÙŠ Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Instagram
        const imgStyle = (data.platform === 'Instagram' && data.profilePic) 
            ? 'max-height: 100px; width: 100px;' 
            : 'max-height: 150px; width: auto;';
        const imgClass = (data.platform === 'Instagram' && data.profilePic) 
            ? 'rounded-circle' : 'rounded';
            
        analysisHTML += `<div class="mb-3 text-center">
            <img src="${imgSrc}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©" class="img-fluid ${imgClass} shadow-sm" style="${imgStyle}">
        </div>
        <hr>`;
    }
    // ================================================================

    analysisHTML += '<ul class="list-unstyled mb-0">';

    //  âœ… Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ø­ØµÙ‘Ù†: ÙŠØ¹Ø§Ù„Ø¬ ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¨Ø£Ù…Ø§Ù†
    // ================================================================
    // user.html - Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù€ switch Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø¯Ø§Ø®Ù„ analyzeBtn.addEventListener)

    switch (data.platform) {
      case 'YouTube':
        analysisHTML += `<li><strong><i class="fab fa-youtube text-danger"></i> Ø§Ù„Ù‚Ù†Ø§Ø©:</strong> ${data.channel || 'ØºÙŠØ± Ù…ØªØ§Ø­'}</li>`;
        analysisHTML += `<li><strong><i class="fas fa-eye"></i> Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</strong> ${formatNumber(data.views)}</li>`;
        analysisHTML += `<li><strong><i class="fas fa-thumbs-up"></i> Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª:</strong> ${formatNumber(data.likes)}</li>`;
        analysisHTML += '</ul><hr>';
        const youtubeAdvice = getSmartRecommendation('YouTube', data);
        analysisHTML += `<p class="mb-0"><strong>ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> ${youtubeAdvice}</p>`;
        break;

      case 'TikTok':
        analysisHTML += `<li><strong><i class="fab fa-tiktok"></i> Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> @${data.authorUsername || 'ØºÙŠØ± Ù…ØªØ§Ø­'}</li>`; // âœ… ØªØµØ­ÙŠØ­: Ø§Ø³ØªØ®Ø¯Ø§Ù… authorUsername
        analysisHTML += `<li><strong><i class="fas fa-eye"></i> Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</strong> ${formatNumber(data.views)}</li>`;
        analysisHTML += `<li><strong><i class="fas fa-heart text-danger"></i> Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª:</strong> ${formatNumber(data.likes)}</li>`;
        analysisHTML += `<li><strong><i class="fas fa-comment"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª:</strong> ${formatNumber(data.comments)}</li>`;
        analysisHTML += '</ul><hr>';
        const tiktokAdvice = getSmartRecommendation('TikTok', data);
        analysisHTML += `<p class="mb-0"><strong>ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> ${tiktokAdvice}</p>`;
        break;
        
      // âœ… Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…
    case 'Instagram':
    analysisHTML += `<li><strong><i class="fab fa-instagram text-danger"></i> Ø§Ù„Ù†ÙˆØ¹:</strong> ${data.isVideo ? 'ğŸ¬ Reel ÙÙŠØ¯ÙŠÙˆ' : 'ğŸ‘¤ Ø­Ø³Ø§Ø¨ Ø´Ø®ØµÙŠ'}</li>`;
    analysisHTML += `<li><strong><i class="fas fa-user"></i> Ø§Ù„Ù…Ø¹Ø±Ù:</strong> @${data.username || 'Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…'}</li>`;
    analysisHTML += `<li><strong><i class="fas fa-check-circle text-success"></i> Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${data.message || 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·'}</li>`;
    analysisHTML += '</ul><hr>';
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ØµØ±ÙŠØ©
    analysisHTML += `<div class="text-center mb-3">`;
    
    if (data.thumbnail && data.isVideo) {
      // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù€ Reel Ù…Ø¹ Ø²Ø± ØªØ´ØºÙŠÙ„
      analysisHTML += `<div class="position-relative" style="display: inline-block;">`;
      analysisHTML += `<img src="${data.thumbnail}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù€ Reel" class="img-fluid rounded shadow border" style="max-height: 250px; max-width: 100%;">`;
      analysisHTML += `<div class="position-absolute top-50 start-50 translate-middle">`;
      analysisHTML += `<div class="bg-primary rounded-circle p-3 shadow" style="opacity: 0.9;">`;
      analysisHTML += `<i class="fas fa-play text-white fa-lg"></i>`;
      analysisHTML += `</div></div>`;
      analysisHTML += `</div>`;
      analysisHTML += `<div class="mt-2"><small class="text-muted"><i class="fas fa-video"></i> Ù…Ø¹Ø§ÙŠÙ†Ø© Reel</small></div>`;
    } else if (data.profilePic) {
      // ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª
      analysisHTML += `<img src="${data.profilePic}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„" class="img-fluid rounded-circle shadow border" style="width: 100px; height: 100px; object-fit: cover;">`;
      analysisHTML += `<div class="mt-2"><small class="text-muted"><i class="fas fa-user-circle"></i> ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</small></div>`;
    } else {
      analysisHTML += `<div class="bg-light rounded p-4">`;
      analysisHTML += `<i class="fab fa-instagram fa-3x text-muted mb-2"></i>`;
      analysisHTML += `<div><small class="text-muted">Ù…Ø¹Ø§ÙŠÙ†Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</small></div>`;
      analysisHTML += `</div>`;
    }
    
    analysisHTML += `</div><hr>`;
    
    analysisHTML += `<div class="d-grid gap-2">`;
    analysisHTML += `<a href="${data.previewUrl || `https://www.instagram.com/${data.username || ''}`}" target="_blank" class="btn btn-outline-primary">`;
    analysisHTML += `<i class="fas fa-external-link-alt me-1"></i>ÙØªØ­ Ø¹Ù„Ù‰ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</a>`;
    analysisHTML += `</div>`;
    
    analysisHTML += '<p class="mt-3 mb-0"><strong>ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù… ØµØ§Ù„Ø­ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø·Ù„Ø¨.</p>';
    break;

        

// âœ… Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© ÙÙŠØ³Ø¨ÙˆÙƒ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·)
case 'Facebook':
    if (data.error) {
        analysisHTML += `<div class="alert alert-danger">âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${data.message}</div>`;
        break;
    }

    // ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø®Ø§ØµØ© Ø¨ÙÙŠØ³Ø¨ÙˆÙƒ
    analysisHTML += `<ul class="list-unstyled mb-0">`;

    analysisHTML += `<li><strong><i class="fab fa-facebook-square text-primary"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${data.title || 'Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ'}</li>`;
    if (data.description) {
        analysisHTML += `<li><strong><i class="fas fa-info-circle"></i> Ø§Ù„ÙˆØµÙ:</strong> ${data.description.substring(0, 150)}...</li>`;
    }

    // âœ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø´ÙƒÙ„ Ø«Ø§Ø¨Øª ÙˆÙ…ØªÙ†Ø§Ø¸Ø±
    analysisHTML += `<li><strong><i class="fas fa-eye text-success"></i> Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:</strong> ${formatNumber(data.views)}</li>`;
    analysisHTML += `<li><strong><i class="fas fa-thumbs-up text-primary"></i> Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª:</strong> ${formatNumber(data.likes)}</li>`;
    analysisHTML += `<li><strong><i class="fas fa-comment text-secondary"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª:</strong> ${formatNumber(data.comments)}</li>`;

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    analysisHTML += `</ul><hr>`;

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ©
    let fbAdvice = 'Ù…Ù†Ø´ÙˆØ± ÙÙŠØ³Ø¨ÙˆÙƒ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¯Ø¹Ù…. ';
    const engagement = ((data.likes + data.comments) / (data.views || 1)) * 100;
    if (engagement > 3) {
        fbAdvice += 'Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ù…ØªØ§Ø²! ÙŠÙ…ÙƒÙ†Ùƒ Ø¯Ø¹Ù…Ù‡ Ø¨Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø±.';
    } else if (engagement > 1) {
        fbAdvice += 'Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¬ÙŠØ¯ØŒ Ù†Ù†ØµØ­ Ø¨Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª.';
    } else {
        fbAdvice += 'Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¶Ø¹ÙŠÙØŒ Ø§Ù„Ø£ÙØ¶Ù„ Ø¯Ø¹Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª ÙˆØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„ØªØ¹Ø²ÙŠØ² Ø¸Ù‡ÙˆØ±Ù‡.';
    }

    analysisHTML += `<p class="mb-3"><strong>ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> ${fbAdvice}</p>`;

    analysisHTML += `<div class="d-grid gap-2">`;
    analysisHTML += `<a href="${linkInput.value}" target="_blank" class="btn btn-outline-primary">
                      <i class="fas fa-external-link-alt me-1"></i> ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ØµÙ„ÙŠ
                    </a>`;
    analysisHTML += `</div>`;
    
    break;

        // ÙÙŠ user.html - ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Telegram
case 'Telegram':
  // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Telegram Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
  const telegramCardHTML = `
    <div class="card shadow-sm border-light mt-3">
      <div class="card-header bg-white d-flex align-items-center py-2">
        <i class="fab fa-telegram fa-2x text-primary me-2"></i>
        <strong>Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… - ${
  (data.type || '').trim().toLowerCase() === 'channel' ? 'Ù‚Ù†Ø§Ø©' :
  (data.type || '').trim().toLowerCase() === 'group' ? 'Ù…Ø¬Ù…ÙˆØ¹Ø©' :
  (data.type || '').trim().toLowerCase() === 'post' ? 'Ù…Ù†Ø´ÙˆØ±' :
  'Ù…Ø­ØªÙˆÙ‰'
}</strong>
      </div>

      <div class="row g-0">
        <div class="col-md-4 d-flex align-items-center justify-content-center p-3 bg-light">
          <img src="${data.profilePic || data.thumbnail || 'https://cdn-icons-png.flaticon.com/512/2111/2111646.png'}"
               class="img-fluid rounded shadow-sm"
               alt="ØµÙˆØ±Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…"
               style="max-height:180px; object-fit:cover; border:2px solid #0088cc;">
        </div>

        <div class="col-md-8">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-2">
              ${data.title || 'Ù‚Ù†Ø§Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…'}
            </h6>

            ${data.username ? `
              <p class="card-text small text-muted mb-2">
                <i class="fas fa-at me-1"></i>@${data.username}
                <span class="badge ${
                  data.type === 'channel' ? 'bg-primary' :
                  data.type === 'group' ? 'bg-success' :
                  data.type === 'post' ? 'bg-info' :
                  'bg-secondary'
                } ms-2">${data.type === 'channel' ? 'Ù‚Ù†Ø§Ø©' :
                        data.type === 'group' ? 'Ù…Ø¬Ù…ÙˆØ¹Ø©' :
                        data.type === 'post' ? 'Ù…Ù†Ø´ÙˆØ±' :
                        data.type === 'bot' ? 'Ø¨ÙˆØª' : 'Ø±Ø§Ø¨Ø·'}
                </span>
              </p>` : ''
            }

            ${data.description ? `
              <p class="card-text small text-muted">${data.description}</p>
            ` : ''}

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Telegram -->
            <div class="d-flex justify-content-around mt-3 pt-3 border-top flex-wrap text-center">
              ${data.members ? `
                <div>
                  <div class="text-primary fw-bold" style="font-size:1.1rem;">${formatNumber(data.members)}</div>
                  <small class="text-muted">Ø£Ø¹Ø¶Ø§Ø¡</small>
                </div>` : ''
              }

              ${data.views ? `
                <div>
                  <div class="text-success fw-bold" style="font-size:1.1rem;">${formatNumber(data.views)}</div>
                  <small class="text-muted">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</small>
                </div>` : ''
              }

              <div>
                <div class="${data.isPrivate ? 'text-danger' : 'text-success'} fw-bold">
                  <i class="fas ${data.isPrivate ? 'fa-lock' : 'fa-globe'} fa-lg"></i>
                </div>
                <small class="text-muted">${data.isPrivate ? 'Ø®Ø§Øµ' : 'Ø¹Ø§Ù…'}</small>
              </div>
            </div>

            ${data.postText ? `
              <div class="mt-3 p-3 bg-light rounded small border">
                <strong>ğŸ“ Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</strong>
                <p class="mb-0 mt-1">${data.postText}</p>
              </div>` : ''
            }

            ${data.error ? `
              <div class="alert alert-warning mt-3 small p-2">
                âš ï¸ ${data.message || 'Ù„Ù… ÙŠÙ…ÙƒÙ† ØªØ­Ù„ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø®Ø§ØµÙ‹Ø§ Ø£Ùˆ Ù…Ø­Ù…ÙŠÙ‹Ø§.'}
              </div>` : ''
            }

            <p class="mt-3 small text-info">
              <strong>ğŸ’¡ ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> 
              ${data.recommendation || 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¯Ø¹Ù…. ÙŠÙ…ÙƒÙ†Ùƒ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª.'}
            </p>
          </div>
        </div>
      </div>

      <div class="card-footer bg-white text-center">
        <a href="${data.url || linkInput.value}" target="_blank" class="btn btn-sm btn-primary">
          <i class="fab fa-telegram me-1"></i> ÙØªØ­ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        </a>
        ${data.members ? `<span class="ms-2 small text-muted">ğŸ‘¥ ${formatNumber(data.members)} Ø¹Ø¶Ùˆ</span>` : ''}
      </div>
    </div>
  `;

  analysisContainer.innerHTML = telegramCardHTML;
  return;
              
    // ÙÙŠ user.html - Ø¯Ø§Ø®Ù„ analyzeBtn.addEventListener - Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© Twitter
case 'Twitter':
    // Ø¨Ù†Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Twitter Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    const twitterCardHTML = `
      <div class="card shadow-sm border-light mt-3">
        <div class="card-header bg-white d-flex align-items-center py-2">
            <i class="fab fa-twitter fa-2x text-info me-2"></i>
            <strong>Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙˆÙŠØªØ± (X)</strong>
        </div>
        <div class="row g-0">
          <div class="col-md-4 d-flex align-items-center justify-content-center p-3 bg-light">
            <img src="${data.thumbnail}" class="img-fluid rounded shadow-sm" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙˆÙŠØªØ±" style="max-height: 180px; object-fit: cover;">
          </div>
          <div class="col-md-8">
            <div class="card-body">
              <h6 class="card-title fw-bold mb-2">${data.title || 'ØªØºØ±ÙŠØ¯Ø© ØªÙˆÙŠØªØ±'}</h6>
              <p class="card-text small text-muted mb-2">
                <i class="fas fa-user me-1"></i>Ø¨ÙˆØ§Ø³Ø·Ø©: @${data.authorUsername || 'Ù…Ø³ØªØ®Ø¯Ù…'}
              </p>
              ${data.description ? `<p class="card-text small text-muted">${data.description.substring(0, 120)}...</p>` : ''}
              
              <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Twitter -->
              <div class="d-flex justify-content-between gap-2 mt-3 pt-3 border-top">
                <div class="text-center">
                  <div class="text-primary fw-bold">${formatNumber(data.likes)}</div>
                  <small class="text-muted">Ø¥Ø¹Ø¬Ø§Ø¨</small>
                </div>
                <div class="text-center">
                  <div class="text-success fw-bold">${formatNumber(data.retweets)}</div>
                  <small class="text-muted">Ø¥Ø¹Ø§Ø¯Ø© ØªØºØ±ÙŠØ¯</small>
                </div>
                <div class="text-center">
                  <div class="text-info fw-bold">${formatNumber(data.replies)}</div>
                  <small class="text-muted">Ø±Ø¯ÙˆØ¯</small>
                </div>
                <div class="text-center">
                  <div class="text-warning fw-bold">${formatNumber(data.views)}</div>
                  <small class="text-muted">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</small>
                </div>
              </div>
              
              <p class="mt-3 small"><strong>ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ:</strong> ${data.recommendation || 'Ø§Ù„ØªØºØ±ÙŠØ¯Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¯Ø¹Ù….'}</p>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white text-center">
            <a href="${linkInput.value}" target="_blank" class="btn btn-sm btn-outline-info">
                <i class="fab fa-twitter me-1"></i> ÙØªØ­ Ø¹Ù„Ù‰ ØªÙˆÙŠØªØ±
            </a>
        </div>
      </div>
    `;
    
    analysisContainer.innerHTML = twitterCardHTML;
    return;
    }
        
    analysisHTML += '</div>';
    analysisContainer.innerHTML = analysisHTML;
  } catch (err) {
    analysisContainer.innerHTML = `<div class="alert alert-danger">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ†ÙŠ: ${err.message}</div>`;
    console.error(err);
  } finally {
    analyzeBtn.disabled = false;
  }
});

// --- (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ---

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰
backBtn.addEventListener('click', () => {
  step2.style.display = 'none';
  step1.style.display = 'block';
  orderStatusBox.innerHTML = '';
});

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙØ¦Ø§Øª
function populateCategories() {
  servicesByCategory = allServices.reduce((acc, s) => {
    if (!s.category) return acc;
    const key = String(s.category).toLowerCase().trim();
    (acc[key] = acc[key] || []).push(s);
    return acc;
  }, {});
  categoriesGrid.innerHTML = '';
  for (const cat in servicesByCategory) {
    const icon = categoryIcons[cat] || categoryIcons['Ù…Ù…ÙŠØ²'];
    const col = document.createElement('div');
    col.className = 'col-lg-3 col-md-4 col-sm-6';
    col.innerHTML = `<div class="category-card p-3" data-cat="${cat}"><img src="${icon}" class="category-icon" alt="${cat}" /><strong class="d-block mt-2 text-capitalize">${cat}</strong></div>`;
    col.querySelector('.category-card').addEventListener('click', () => goToStep(2, cat));
    categoriesGrid.appendChild(col);
  }
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ§Øª
function goToStep(stepNumber, category = null) {
  if (stepNumber === 1) {
    step1.style.display = 'block';
    step2.style.display = 'none';
  } else if (stepNumber === 2 && category) {
    step1.style.display = 'none';
    step2.style.display = 'block';
    populateOrderMachine(category);
  }
}

// Ø¯Ø§Ù„Ø© Ù…Ù„Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨
function populateOrderMachine(category) {
  orderCategoryTitle.textContent = `Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø§Øª ${category}`;
  const services = servicesByCategory[category] || [];
  serviceSelect.innerHTML = `<option value="" selected disabled>Ø§Ø®ØªØ± Ø®Ø¯Ù…Ø©...</option>`;
  services.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.textContent = s.name + (s.type === 'fixed' ? ` â€” Ø³Ø¹Ø± Ø«Ø§Ø¨Øª $${s.price || 0}` : ` â€” ${s.rate || 0}$ / 1k`);
    serviceSelect.appendChild(opt);
  });
  resetOrderForm();
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±
function updatePrice() {
  const serviceId = serviceSelect.value;
  if (!serviceId) { totalPriceDisplay.textContent = '$0.00'; return; }
  const service = allServices.find(s => String(s.id) === String(serviceId));
  if (!service) return;
  if (service.type === 'fixed') {
    totalPriceDisplay.textContent = `$${parseFloat(service.price || 0).toFixed(2)}`;
  } else {
    const q = parseInt(quantityInput.value) || 0;
    const pricePerOne = (parseFloat(service.rate || 0) / 1000);
    const total = pricePerOne * q;
    totalPriceDisplay.textContent = `$${total.toFixed(2)}`;
  }
}

// Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
function resetOrderForm() {
  quantityInput.value = '';
  linkInput.value = '';
  analysisContainer.innerHTML = '';
  limitsInfo.textContent = '';
  totalPriceDisplay.textContent = '$0.00';
  quantityContainer.style.display = 'none';
}

// Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø©
serviceSelect.addEventListener('change', () => {
  const sid = serviceSelect.value;
  const svc = allServices.find(s => String(s.id) === String(sid));
  if (!svc) { quantityContainer.style.display = 'none'; limitsInfo.textContent = ''; updatePrice(); return; }
  if (svc.type === 'quantity') {
    quantityContainer.style.display = 'block';
    limitsInfo.textContent = `Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: ${svc.min || 0} | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${svc.max || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
  } else {
    quantityContainer.style.display = 'none';
    limitsInfo.textContent = '';
  }
  updatePrice();
});

// Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
quantityInput.addEventListener('input', updatePrice);

// Ø¯Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·)
confirmOrderBtn.addEventListener('click', async () => {
  const serviceId = serviceSelect.value;
  const link = linkInput.value.trim();
  const quantity = quantityInput.value ? Number(quantityInput.value) : null;

  if (!serviceId || !link) {
    orderStatusBox.innerHTML = `<div class="alert alert-warning">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­.</div>`;
    return;
  }

  const service = allServices.find(s => String(s.id) === String(serviceId));
  if (!service) { orderStatusBox.innerHTML = `<div class="alert alert-danger">âŒ Ø§Ù„Ø®Ø¯Ù…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©.</div>`; return; }

  const category = String(service.category).toLowerCase().trim();
  const allowedKeywords = platformKeywords[category];
  if (allowedKeywords && !allowedKeywords.some(keyword => link.includes(keyword))) {
    orderStatusBox.innerHTML = `<div class="alert alert-danger">âŒ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡ Ù„Ø§ ÙŠÙ†ØªÙ…ÙŠ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© "${category}". Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­.</div>`;
    return;
  }

  if (service.type === 'quantity') {
    if (!quantity || quantity <= 0) {
      orderStatusBox.innerHTML = `<div class="alert alert-warning">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©.</div>`; return;
    }
    if (service.min && quantity < service.min) {
      orderStatusBox.innerHTML = `<div class="alert alert-warning">âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ ${service.min}.</div>`; return;
    }
    if (service.max && quantity > service.max) {
      orderStatusBox.innerHTML = `<div class="alert alert-warning">âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${service.max}.</div>`; return;
    }
  }
  
  let price = 0;
  if (service.type === 'fixed') price = parseFloat(service.price || 0);
  else price = ((parseFloat(service.rate || 0) / 1000) * (quantity || 0));

  orderStatusBox.innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border me-3" role="status"></div> Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...</div>`;

  try {
    const res = await fetch('/api/orders', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ serviceId, link, quantity, price })
    });
    if (!res.ok) {
      const e = await res.json().catch(()=>({error:'Ø®Ø·Ø£'}));
      throw new Error(e.error || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨');
    }

    const order = await res.json();
    const msgText = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ›’%0AØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${order.id}%0AØ§Ù„Ø®Ø¯Ù…Ø©: ${service.name}%0AØ§Ù„Ø±Ø§Ø¨Ø·: ${order.link}%0AØ§Ù„ÙƒÙ…ÙŠØ©: ${order.quantity||'â€”'}%0AØ§Ù„ØªÙƒÙ„ÙØ©: $${order.price.toFixed(2)}`;
    if (PHONE_NUMBER && PHONE_NUMBER.length > 5) {
      window.open(`https://wa.me/${PHONE_NUMBER}?text=${msgText}`, '_blank');
    }

    orderStatusBox.innerHTML = `
      <div class="alert alert-success">
        âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­. Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong>${order.id}</strong>  
        <p class="mb-1">Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${order.status}</strong></p>
        <div class="mt-2">
          <button onclick="navigator.clipboard.writeText('${order.id}'); alert('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨');" class="btn btn-sm btn-outline-secondary">Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</button>
          <button onclick="document.getElementById('orderIdInput').value = '${order.id}'; trackOrder();" class="btn btn-sm btn-outline-primary">Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>
    `;
    resetOrderForm();
  } catch (err) {
    console.error(err);
    orderStatusBox.innerHTML = `<div class="alert alert-danger">âŒ ${err.message}.</div>`;
  }
});

// Ø¯Ø§Ù„Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
async function trackOrder() {
  const id = orderIdInput.value.trim();
  if (!id) {
    orderResult.innerHTML = `<div class="alert alert-warning">âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨.</div>`;
    return;
  }
  orderResult.innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border me-3" role="status"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>`;
  try {
    const res = await fetch('/api/orders/public/' + encodeURIComponent(id));
    if (res.status === 404) { orderResult.innerHTML = `<div class="alert alert-danger">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù….</div>`; return; }
    if (!res.ok) { orderResult.innerHTML = `<div class="alert alert-danger">âŒ ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«.</div>`; return; }
    
    const order = await res.json();
    const service = allServices.find(s => String(s.id) === String(order.serviceId));
    const svcName = service ? service.name : `Ø®Ø¯Ù…Ø© Ø±Ù‚Ù… ${order.serviceId}`;
    const statusMap = {
        pending: "â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
        processing: "âš™ï¸ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
        completed: "âœ… Ù…ÙƒØªÙ…Ù„",
        rejected: "âŒ Ù…Ø±ÙÙˆØ¶"
    };
    const statusLabel = statusMap[order.status] || order.status;

    orderResult.innerHTML = `
      <div class="card p-3 bg-light border">
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.id}</p>
        <p><strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${svcName}</p>
        <p><strong>Ø§Ù„Ø±Ø§Ø¨Ø·:</strong> <a href="${order.link}" target="_blank" rel="noopener">${order.link}</a></p>
        <p><strong>Ø§Ù„ÙƒÙ…ÙŠØ©:</strong> ${order.quantity || 'â€”'}</p>
        <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> $${order.price ? order.price.toFixed(2) : '0.00'}</p>
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${statusLabel}</p>
        <p class="small text-muted mb-0">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(order.createdAt).toLocaleString() || 'â€”'}</p>
      </div>
    `;
  } catch (err) {
    console.error(err);
    orderResult.innerHTML = `<div class="alert alert-danger">âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.</div>`;
  }
}

trackBtn.addEventListener('click', trackOrder);
orderIdInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') trackOrder(); });

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
async function initialize() {
  try {
    const res = await fetch('/api/services');
    if (!res.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….');
    allServices = await res.json();
    populateCategories();
  } catch (err) {
    console.error(err);
    categoriesGrid.innerHTML = `<div class="alert alert-danger p-3">${err.message} Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.</div>`;
  }
}

// Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
initialize();
        
</script>
</body>
</html>
